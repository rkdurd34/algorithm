### 웹 통신의 큰 흐름: [https://www.google.com/](https://www.google.com/) 을 접속할 때 일어나는 일

---

> 기본적인 통신의 흐름

![스크린샷 2021-05-06 오전 11.01.08](/Users/kang-kyung-wook/Desktop/스크린샷 2021-05-06 오전 11.01.08.png)

웹에 연결된 컴퓨터는 클라이언트 와 서버 라고 합니다. 그들이 어떻게 상호작용하는가에 대한 간소화된 다이어그램은 다음과 같습니다

- 클라이언트는 일반적인 웹 사용자의 인터넷이 연결된 장치들 (예를 들어, 여러분의 컴퓨터는 WI-FI에 연결되어 있고, 또는 여러분의 폰은 모바일 네트워크에 연결되어 있습니다) 과 이런 장치들에서 이용가능한 웹에 접근하는 소프트웨어 (일반적으로 파이어폭스 또는 크롬 과 같은 웹 브라우저) 입니다.
- 서버는 웹페이지, 사이트, 또는 앱을 저장하는 컴퓨터입니다. 클라이언트의 장비가 웹페이지에 접근하길 원할 때, 서버로부터 클라이언트의 장치로 사용자의 웹 브라우저에서 보여지기 위한 웹페이지의 사본이 다운로드 됩니다.

> **웹에서 URL을 입력한 이 후의 작동 방식**

1. 브라우저의 URL 파싱(**어떤 프로토콜**로, **어느 도메인**으로, **어떤 포트**로 보낼지 해석)

   ![스크린샷 2021-05-06 오전 11.01.17](/Users/kang-kyung-wook/Desktop/스크린샷 2021-05-06 오전 11.01.17.png)

2. [www.daum.net](http://www.daum.net/) 이라는 주소로는 컴퓨터끼리 통신할 수 없습니다. 이를 인터넷 상에서 컴퓨터가 읽을 수 있는 IP주소로 변환해야 서로 통신이 가능하게 됩니다. 우선 브라우저에서는 자신의 **로컬 호스트 파일**과 **브라우저 캐시**에 해당 URL이 존재하는지 확인합니다. 존재하지 않는다면 도메인 주소를 IP주소로 변환해주는 DNS(Domain Name System) 서버에 요청하여 해당 URL을 IP주소**(진짜주소)**로 변환합니다.

- 참고사항 OSI 7계층

  ![스크린샷 2021-05-02 오후 5.57.09](/Users/kang-kyung-wook/Desktop/스크린샷 2021-05-02 오후 5.57.09.png)

  

  **이질적인 시스템 (H/W, S/W간 상호 접속을 위한 개념을 규정하기 위하여 설계되었고 OSI 규격을 개발하는데 그 범위를 정하는 역할**
  
  1. 통신 프로그램 A를 통해 데이터를 받아 **응용 계층**에서 데이터를 적재, AH는 데이터 타입
  2. **표현 계층**에서 응용계층에서 받은 실제 데이터를 암호화 진행
  3. **세션 계층**에서 요청 보낸 목적지에서 어떤 식으로 통신을 할지 방식을 확정(단방향 통신할지, 양방향 통신할지)ㅈ
  4. **전송 계층**에서는 목적지에서 어떤 프로그램과 연결 될지를 정해주는 계층
  5. **네트워크 계층**에서는 상대(상대방의 네트워크)에게 갈 수 있는 주소, 위치, 경로 등을 패킹 하는 곳
  6. **데이터링크 계층** 에서는 어떤식으로 전송을 할지 설정 및 **물리 계층**에서 신호로 전환해서 목적지로 전송

3. 라우터를 통해 해당 서버의 게이트웨이까지 이동 : 목적지 네트워크에 도착하기 위해 라우터를 타서 해당 네트워크까지 이동 이러한 과정에서 사용 되는것은 IP프로토콜( IP주소 체계)→ 연결 되어 있지 않은 상태에서 IP주소를 사용하여 서로를 연결하므로 **비연결형 프로토콜**이라고도 부름

ex) 우편을 보냈을때 ~아파트 ~동까지만 보내고 ~호 우편함까지만 가는 과정이라고 생각하면 이해가 편함 문 앞까지 도착은 X

![스크린샷 2021-05-06 오전 11.02.48](/Users/kang-kyung-wook/Desktop/스크린샷 2021-05-06 오전 11.02.48.png)

4. ARP를 통해 IP주소를 MAC주소로 변환 (ARP프로토콜)

이후에 해당 컴퓨터의 LAN카드의 고유번호를 통해 네트워크 안에 있는 특정한 컴퓨터로 접근.(이더넷 주소, 랜주소 → 물리적 주소 vs IP주소 → 논리적 주소) 이제는 문 앞까지 간 상황과 같습니다.

5. 해당 컴퓨터 내의 특정 프로그램과의 연결(TCP 프로토콜 → 연결형 프로토콜)

대상 서버와 통신하기 위해 TCP 소켓 연결을 진행합니다. 소켓 연결은 3-way-handshake라는 과정을 통해 이루어집니다. 이 과정은 마치 전화를 거는 것과 유사합니다. 서버에게 전화를 걸고, 서버는 해당 전화를 확인하고 전화를 받습니다. 전화를 건사람이 여보세요라고 말하는것으로 생각하면 좋습니다 웹서버(apache, nginx) 이므로 80번 포트를 사용하여 프로그램을 부르고 통신을 진행. 오류가 없을시 웹페이지의 정보가 응답으로 돌아온다.

실제 구글 응답값

![스크린샷 2021-05-06 오전 10.55.41](/Users/kang-kyung-wook/Desktop/스크린샷 2021-05-06 오전 10.55.41.png)

이외의 https 프로토콜은 http프로토콜에서 추가 되는 몇가지가 있습니다.

> **DNS 서버로 요청을 보내기 전**

### HSTS 목록 조회

HSTS(HTTP Strict transport security), HTTP를 허용하지 않고 HTTPS를 사용하는 연결만 허용하는 기능입니다. 만약 HTTP로 요청이 왔다면 HTTP 응답 헤더에 "Strict Transport Security"라는 필드를 포함하여 응답하고 이를 확인한 브라우저는 해당 서버에 요청할 때 HTTPS만을 통해 통신하게 됩니다. 그리고 자신의 HSTS캐시에 해당 URL을 저장하는데 이를 HSTS 목록이라고 부릅니다.

이를 통해 브라우저에서는 이 HSTS 목록 조회를 통해 해당 요청을 HTTPS로 보낼지 판단합니다. HSTS목록에 해당 URL이 존재한다면 명시적으로 HTTP를 통해 요청한다 해도 브라우저가 이를 HTTPS로 요청합니다.

> **TCP 소켓 연결 과정**

서로 암호화 통신을 위한 TLS 핸드쉐이킹이 추가됩니다. 이를 통해 서버와 클라이언트는 암호화 통신을 진행할 수 있습니다.![스크린샷 2021-05-02 오후 5.57.02](/Users/kang-kyung-wook/Desktop/스크린샷 2021-05-02 오후 5.57.02.png

![스크린샷 2021-05-06 오전 11.02.55](/Users/kang-kyung-wook/Desktop/스크린샷 2021-05-06 오전 11.02.55.png)

전체적인 요약도

https://www.notion.so/292c6e6217904f0cb5fa5cfc310cea3c#204950c368db465480241773c7f02d10

